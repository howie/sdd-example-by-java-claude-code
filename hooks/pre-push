#!/bin/bash
#
# Pre-push hook to run tests and linting before pushing
#
# To install this hook, run:
#   cp hooks/pre-push .git/hooks/pre-push && chmod +x .git/hooks/pre-push
#
# To bypass this hook (not recommended), use:
#   git push --no-verify
#

echo "Running pre-push checks..."
echo ""

# Run tests
echo "Running tests..."
./gradlew test --no-daemon
if [ $? -ne 0 ]; then
    echo ""
    echo "Tests failed. Push aborted."
    echo "Fix the tests or use 'git push --no-verify' to bypass this check."
    exit 1
fi

# Run checkstyle
echo ""
echo "Running Checkstyle..."
./gradlew checkstyleMain checkstyleTest --no-daemon
if [ $? -ne 0 ]; then
    echo ""
    echo "Checkstyle violations found. Push aborted."
    echo "Fix the code style issues or use 'git push --no-verify' to bypass this check."
    exit 1
fi

echo ""
echo "All checks passed! Proceeding with push..."
exit 0
